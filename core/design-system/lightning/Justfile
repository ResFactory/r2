# Run regularly to update dependencies and perform similar maintenance
maintain: acquire-slds-icons acquire-markdown-css

# Acquire the typical Markdown CSS which will be used by the client
acquire-markdown-css:
    #!/bin/bash
    SRC_URL=../../render/markdown/markdown.css.ts
    DEST_CSS=client-cargo/style/markdown.auto.css
    echo -e "/* Code generated. DO NOT EDIT. */" > "$DEST_CSS"
    echo -e "/* Generated by Justfile acquire-markdown-css $(date) from $SRC_URL by $(whoami) on $(hostname) */" >> "$DEST_CSS"
    deno run --unstable "$SRC_URL" >> "$DEST_CSS"

# Acquire Lightning Design System icons from source and cache them locally
acquire-slds-icons:
    #!/bin/bash
    set -euo pipefail
    SRC_URL=https://www.lightningdesignsystem.com/assets/downloads/salesforce-lightning-design-system-icons.zip
    TMPDIR=${TMPDIR:-$(dirname $(mktemp))}
    DEST_TMP=$TMPDIR/salesforce-lightning-design-system-icons.zip
    DEST_HOME="./client-cargo/image/slds-icons"
    rm -rf "$DEST_HOME"
    curl -sSL $SRC_URL > "$DEST_TMP" 
    unzip -qq "$DEST_TMP" action-sprite/* custom-sprite/* doctype-sprite/* standard-sprite/* utility-sprite/* -d $DEST_HOME
    echo "The icons in this directory were downloaded from [lightningdesignsystem.com]($SRC_URL) on $(date).\n\nWe only use the sprites and not all the individual \`*.png\` and \`*.svg\` files so this is a partial directory." > "$DEST_HOME/README.md"

# Acquire github.com/optoolco/tonic lightweight Web Component Framework
acquire-tonic:
    #!/bin/bash
    set -euo pipefail
    SRC_URL=https://denopkg.com/optoolco/tonic@v13.3.5/src/index.js
    FINAL_URL=`curl -Ls -o /dev/null -w %{url_effective} $SRC_URL`
    TONIC="./client-cargo/script/tonic.js"
    echo -e "// deno-lint-ignore-file\n// deno-fmt-ignore-file\n// acquired on $(hostname) by $(whoami) at $(date) from $FINAL_URL\n" > "$TONIC"
    curl -s $FINAL_URL >> "$TONIC"
