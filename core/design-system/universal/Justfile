# Run regularly to update dependencies and perform similar maintenance
maintain: acquire-markdown-css

# Acquire the typical Markdown CSS which will be used by the client
acquire-markdown-css:
    #!/bin/bash
    SRC_URL=../../render/markdown/markdown.css.ts
    DEST_CSS=client-cargo/style/markdown.auto.css
    echo -e "/* Code generated. DO NOT EDIT. */" > "$DEST_CSS"
    echo -e "/* Generated by Justfile acquire-markdown-css from $SRC_URL [$(date -r $SRC_URL), $(stat -c%s $SRC_URL) bytes] by $(whoami) on $(hostname) */" >> "$DEST_CSS"
    deno run --unstable "$SRC_URL" >> "$DEST_CSS"

# Acquire github.com/optoolco/tonic lightweight Web Component Framework
acquire-tonic:
    #!/bin/bash
    set -euo pipefail
    DEST=./client-cargo/script
    VERSION=v14.0.0
    assetBaseName=(tonic.min.js tonic.min.esm.js)
    assetAcqName=(tonic-$VERSION.min.js tonic-$VERSION.min.esm.js)
    for i in ${!assetBaseName[@]}; do
        assetBaseName=${assetBaseName[$i]}
        SRC_URL=https://denopkg.com/optoolco/tonic@$VERSION/dist/$assetBaseName
        FINAL_URL=`curl -Ls -o /dev/null -w %{url_effective} $SRC_URL`
        curl -s -o "$DEST/${assetAcqName[$i]}" $FINAL_URL
    done
