<!DOCTYPE html>
<!-- follow guidelines in README.md, see FOUC section for why display:none is used-->
<html lang="en" style="display:none">

<head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="./path.actuate.css" />
    <script src="./path.actuate.js" type="module"></script>
</head>

<body>
    <main>
        <article>
            <header>
                <h1>Health</h1>
            </header>

            <section class="card">
                <div class="card-body">
                    <h5 class="card-title">Errors</h5>
                    <div id="unhealthy-json-errors"></div>
                </div>
            </section>

            <section class="card">
                <div class="card-body">
                    <h5 class="card-title">Warnings</h5>
                    <div id="unhealthy-json-warnings"></div>
                </div>
            </section>

            <details>
                <summary class="h5">health.json</summary>
                <section class="card">
                    <div id="health-json" class="card-body"></div>
                </section>
            </details>
        </article>
    </main>

    <script src="https://cdn.rawgit.com/caldwell/renderjson/master/renderjson.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            fetch("/operational-context/observability/health.json").then(resp => {
                resp.json().then(health => {
                    const errors = [];
                    const warnings = [];
                    Object.entries(health.checks).forEach(check => {
                        const [serviceIdentity, components] = check;
                        for (const c of components) {
                            switch (c.status) {
                                case "pass":
                                    break;
                                case "warn":
                                    warnings.push({ service: serviceIdentity, ...c });
                                    break;
                                case "fail":
                                    errors.push({ service: serviceIdentity, ...c });
                                    break
                            }
                        }
                    });
                    renderjson.set_show_to_level(2);
                    document.getElementById("unhealthy-json-errors").prepend(renderjson(errors));
                    document.getElementById("unhealthy-json-warnings").prepend(renderjson(warnings));

                    // API: https://github.com/caldwell/renderjson
                    renderjson.set_show_to_level(4);
                    document.getElementById("health-json").prepend(renderjson(health));
                });
            })
        });
    </script>
</body>

</html>