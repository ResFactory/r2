<!DOCTYPE html>
<!-- follow guidelines in README.md, we hide HTML to prevent flash of unstyled content (FOUC) -->
<html lang="en" style="display:none">

<head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="../path.actuate.css" />
    <script src="../path.actuate.js" type="module"></script>
    <script src="https://unpkg.com/ag-grid-community/dist/ag-grid-community.min.js"></script>
</head>

<!-- always use Semantic tags whenever possible (https://html.spec.whatwg.org/multipage/sections.html#the-article-element) -->

<body data-layout="auto">
    <!-- Here is our page's main content, should always be present because the auto-layout engine in Executive will build around it-->
    <main>
        <!-- It contains an article -->
        <article>
            <header>
                <h1>Design System</h1>
            </header> <!-- note use of <header> for article now, not page -->

            <div class="card">
                <div class="card-body">
                    This publication uses the <b><span id="design-system-identity"></span></b> design system located at <span id="design-system-location"></span>.
                </div>
            </div>

            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Design System Layouts ("renderers")</h5>

                    <div id="renderersGrid" class="ag-theme-alpine"></div>
                </div>
            </div>
        </article>
    </main>

    <script type="module">
        import { humanPath } from "../deps.auto.js";

        document.addEventListener('DOMContentLoaded', function () {
            const renderersGridElem = document.querySelector('#renderersGrid');
            if (renderersGridElem) {
                fetch("/publication/inspect/project.json").then(resp => resp.json()).then(project => {
                    const ds = project["Design System"].designSystem;
                console.dir(ds);
                    document.getElementById("design-system-identity").innerHTML = ds?.identity;
                    document.getElementById("design-system-location").innerHTML = ds?.location?.moduleImportMetaURL;
                });

                fetch("/publication/inspect/renderers.json").then(resp => resp.json()).then(renderers => {
                    const columnDefs = [
                        { field: "identity" },
                        {
                            field: "location",
                            cellRenderer: "locationCellRenderer",
                        }
                    ];
                    const gridOptions = {
                        columnDefs: columnDefs,
                        rowData: renderers,
                        domLayout: 'autoHeight',
                        onGridReady: (event) => event.columnApi.autoSizeAllColumns(),
                        components: {
                            // see https://www.ag-grid.com/javascript-grid/components/
                            locationCellRenderer: (params) => {
                                if ("location" in params.data) {
                                    let src = params.data.location.moduleImportMetaURL;
                                    let srcHref = undefined;
                                    if (src.startsWith("file://")) {
                                        src = src.substring(7);
                                        const editorRedirect = `/workspace/editor-redirect/abs${src}`;
                                        srcHref = humanPath(src, 90, (basename) => `<a href="${editorRedirect}" class="fw-bold">${basename}</a>`);
                                    } else {
                                        srcHref = humanPath(src, 90, (basename) => `<a href="${src}" class="fw-bold">${basename}</a>`);
                                    }
                                    return srcHref;
                                }
                                return params.value;
                            },
                        },
                    };
                    new agGrid.Grid(renderersGridElem, gridOptions);
                })
            }
        });
    </script>
</body>

</html>